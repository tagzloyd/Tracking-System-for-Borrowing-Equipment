import{U as l,j as e,Q as W,a as v}from"./app-mVC3eKZ5.js";import{A as B}from"./app-layout-BeNBxOFm.js";import{F}from"./MagnifyingGlassIcon-BvmeZZQC.js";import"./app-logo-icon-CQS8Y7tT.js";import"./index-X4o8WuMK.js";import"./index-B1peZ9a_.js";const M=[{title:"Log",href:"/tracking"}],C=[5,10,25];function Q(){const[a,h]=l.useState("students"),[L,u]=l.useState([]),[S,m]=l.useState(!1),[b,w]=l.useState(null),[f,_]=l.useState(""),[n,c]=l.useState(0),[o,k]=l.useState(C[0]);l.useEffect(()=>{(async()=>{m(!0),w(null);try{const s=a==="students"?"/api/tracking":"/api/outsider",r=await v.get(s);u(r.data)}catch(s){w(s.message||`Failed to fetch ${a} logs`)}finally{m(!1)}})()},[a]);const y=L.filter(t=>{const s=f.toLowerCase();return t.name.toLowerCase().includes(s)||t.student_id&&t.student_id.toLowerCase().includes(s)||t.email&&t.email.toLowerCase().includes(s)||t.phone&&t.phone.toLowerCase().includes(s)||t.department&&t.department.toLowerCase().includes(s)||t.course&&t.course.toLowerCase().includes(s)||t.year&&t.year.toLowerCase().includes(s)||t.equipment_name&&t.equipment_name.toLowerCase().includes(s)}),x=y.length,p=Math.ceil(x/o),j=y.slice(n*o,n*o+o),d=t=>{c(t)},D=t=>{k(Number(t.target.value)),c(0)},P=n*o+1,R=Math.min((n+1)*o,x);function g(t){return t?new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"-"}function E(t){if(t.status==="Returned")return"Returned";if(!t.end_time)return"Borrowed";const s=new Date,r=new Date(t.end_time);return s>r?"Deadline":"Borrowed"}const T=async(t,s,r)=>{try{await v.patch(`/api/tracking/${t}/status`,{status:r,type:s}),u(N=>N.map(i=>i.id===t?{...i,status:r,end_time:r==="Returned"?new Date().toISOString():i.end_time}:i)),window.dispatchEvent(new Event("dashboard-refresh"))}catch{alert("Failed to update status")}};return e.jsxs(B,{breadcrumbs:M,children:[e.jsx(W,{title:"Tracking"}),e.jsxs("div",{className:"w-full px-2 sm:px-4 py-4",children:[e.jsx("div",{className:"flex items-center mb-4",children:e.jsxs("div",{className:"relative w-full max-w-xs",children:[e.jsx("span",{className:"absolute inset-y-0 left-0 flex items-center pl-3",children:e.jsx(F,{className:"h-5 w-5 text-gray-400","aria-hidden":"true"})}),e.jsx("input",{type:"text",className:"block w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 text-sm",placeholder:"Search by name, ID, email, equipment...",value:f,onChange:t=>{_(t.target.value),c(0)}})]})}),e.jsx("div",{className:"mb-4 border-b border-gray-200",children:e.jsxs("ul",{className:"flex flex-wrap -mb-px",children:[e.jsx("li",{className:"mr-2",children:e.jsx("button",{onClick:()=>h("students"),className:`inline-block p-4 border-b-2 rounded-t-lg transition-all duration-150 ${a==="students"?"text-blue-600 border-blue-600 font-semibold bg-blue-50":"border-transparent hover:text-gray-600 hover:border-gray-300"}`,children:"Students"})}),e.jsx("li",{className:"mr-2",children:e.jsx("button",{onClick:()=>h("outsiders"),className:`inline-block p-4 border-b-2 rounded-t-lg transition-all duration-150 ${a==="outsiders"?"text-blue-600 border-blue-600 font-semibold bg-blue-50":"border-transparent hover:text-gray-600 hover:border-gray-300"}`,"aria-current":"page",children:"Outsiders"})})]})}),b&&e.jsx("div",{className:"mb-2 text-red-600",children:b}),e.jsx("div",{className:"w-full overflow-x-auto rounded-lg shadow border border-gray-200 bg-white",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 text-sm",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[a==="students"&&e.jsxs(e.Fragment,{children:[e.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-600 whitespace-nowrap",children:"Student ID"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-600 whitespace-nowrap",children:"Department"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-600 whitespace-nowrap",children:"Course"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-600 whitespace-nowrap",children:"Year"})]}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-600 whitespace-nowrap",children:"Name"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-600 whitespace-nowrap",children:"Contact"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-600 whitespace-nowrap",children:"Email"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-600 whitespace-nowrap",children:"Equipment"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-600 whitespace-nowrap",children:"Start Time"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-600 whitespace-nowrap",children:"End Time"}),e.jsx("th",{className:"px-4 py-3 text-center font-semibold text-gray-600 whitespace-nowrap",children:"Status"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-100",children:S?e.jsx("tr",{children:e.jsx("td",{colSpan:a==="students"?11:7,className:"py-12 text-center",children:e.jsxs("div",{className:"flex justify-center items-center",children:[e.jsxs("svg",{className:"animate-spin h-8 w-8 text-blue-600 mr-2",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8z"})]}),e.jsx("span",{className:"text-blue-600 text-lg",children:"Loading..."})]})})}):j.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:a==="students"?11:7,className:"py-8 text-center text-gray-500",children:"No records found."})}):j.map((t,s)=>{const r=E(t);return e.jsxs("tr",{className:`transition-colors duration-150 ${s%2===0?"bg-white":"bg-blue-50/50"} hover:bg-blue-100`,children:[a==="students"&&e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"px-4 py-3 whitespace-nowrap font-mono text-xs text-gray-700",children:t.student_id}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:t.department||"-"}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:t.course||"-"}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:t.year||"-"})]}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap font-medium",children:t.name}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:t.phone||"-"}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:t.email}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:t.equipment_name||"-"}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:g(t.start_time)}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:t.end_time?g(t.end_time):e.jsx("span",{className:"italic text-gray-400",children:"N/A"})}),e.jsxs("td",{className:"px-4 py-3 text-center whitespace-nowrap",children:[e.jsxs("span",{className:`inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-semibold
                                                    ${r==="Returned"?"bg-green-100 text-green-800 border border-green-300":r==="Borrowed"?"bg-yellow-100 text-yellow-800 border border-yellow-300":"bg-red-100 text-red-800 border border-red-300"}`,children:[r==="Returned"?e.jsxs("svg",{className:"h-4 w-4 mr-1",fill:"none",stroke:"currentColor",strokeWidth:2,viewBox:"0 0 24 24",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"2",fill:"none"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M7 13l3 3 7-7"})]}):r==="Deadline"?e.jsxs("svg",{className:"h-4 w-4 mr-1",fill:"none",stroke:"currentColor",strokeWidth:2,viewBox:"0 0 24 24",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"2",fill:"none"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 8v4m0 4h.01"})]}):e.jsxs("svg",{className:"h-4 w-4 mr-1",fill:"none",stroke:"currentColor",strokeWidth:2,viewBox:"0 0 24 24",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"2",fill:"none"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 6v6l4 2"})]}),r]}),e.jsx("div",{className:"flex flex-col sm:flex-row gap-1 mt-2 justify-center",children:r==="Deadline"&&e.jsx("button",{className:"px-2 py-1 text-xs rounded bg-green-200 text-green-800 hover:bg-green-300 border border-green-300 transition",onClick:()=>T(t.id,a==="students"?"student":"outsider","Returned"),children:"Mark Returned"})})]})]},t.id)})})]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between px-4 py-2 border-t border-neutral-200 bg-white gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-neutral-700",children:"Rows per page:"}),e.jsx("select",{className:"border rounded px-2 py-1 text-sm",value:o,onChange:D,children:C.map(t=>e.jsx("option",{value:t,children:t},t))})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"text-sm text-neutral-700",children:[P,"-",R," of ",x]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{className:"p-1 rounded-full border text-neutral-500 hover:bg-neutral-100 disabled:opacity-50",onClick:()=>d(0),disabled:n===0,"aria-label":"First page",children:"«"}),e.jsx("button",{className:"p-1 rounded-full border text-neutral-500 hover:bg-neutral-100 disabled:opacity-50",onClick:()=>d(n-1),disabled:n===0,"aria-label":"Previous page",children:"‹"}),e.jsx("button",{className:"p-1 rounded-full border text-neutral-500 hover:bg-neutral-100 disabled:opacity-50",onClick:()=>d(n+1),disabled:n>=p-1,"aria-label":"Next page",children:"›"}),e.jsx("button",{className:"p-1 rounded-full border text-neutral-500 hover:bg-neutral-100 disabled:opacity-50",onClick:()=>d(p-1),disabled:n>=p-1,"aria-label":"Last page",children:"»"})]})]})]})]})]})}export{Q as default};
